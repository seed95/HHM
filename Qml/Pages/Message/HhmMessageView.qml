import QtQuick 2.0

Rectangle
{
    id: container

    //Set this variables in cpp
    property string messageId:      ""//The Qml does not support int64
    property string subject:        "النادي تعديل الزوراء كأس العراق"
    property string senderName:     "علاء عباس"
    property string toName:         "ابراهيم محمد"
    property string ccName:         "صفاء هادي"
    property string dateTime:       "۲۴ مايو/ أيار  ۲۰۲۱ الساعة ۱۲:۱۵"
    property var    files:          []
    property string content:        "علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. علي عدنان (من مواليد 19 ديسمبر 1993 في حي القاهرة في الأعظمية، بغداد، العراق)، لاعب المنتخب العراقي لكرة القدم. يلعب في الظهير الايسر مع نادي فانكوفر وايتكابس الكندي في الدوري الأميركي. كان أحد الفائزين كأفضل لاعب آسيوي شاب للعام 2013. لعب في كأس آسيا للشباب 2012 في الإمارات، وحصل مع منتخب بلاده على القلادة الفضية.
عمه هو علي كاظم أحد أشهر لاعبين كرة القدم لعب مع الفرق الكروية العراقية في عقد السبعينيات من القرن الماضي. "

    property int message_state: con.hhm_MESSAGE_NONE_STATE

    //Cpp Signals
    signal downloadAttachFile(int idFile)

    //Qml Signals
    signal replyClicked(string replyMessageId)

    width: 980
    height:
    {
        if( container.message_state===con.hhm_MESSAGE_REPLY_STATE )
        {
            getContentHeight()/*lv_view.contentHeight*/ + lv_view.y
        }
        else//messageState===con.hhm_MESSAGE_VIEW_STATE
        {
            675
        }
    }
    color: "#dcdcdc"

    ListView
    {
        id: lv_view
        width: parent.width
        anchors.left: parent.left
        anchors.top: parent.top
        anchors.bottom: parent.bottom
        clip: true
        interactive:
        {
            if( container.message_state===con.hhm_MESSAGE_VIEW_STATE )
            {
                contentHeight>height
            }
            else
            {
                false
            }
        }

        model: ListModel
        {
            id: lm_view
        }

        onCountChanged:
        {
            contentHeight = getContentHeight()
        }

        delegate: HhmMessageViewElement
        {
            width: container.width
            message_id: idMessage
            text_subject: textSubject
            text_sender_name: textSenderName
            text_to_name: textToName
            text_cc_name: textCcName
            text_date_time: textDateTime
            attach_files: attachFiles
            add_attach: callAttachFiles
            text_content: textContent

            onDownloadFile:
            {
                downloadAttachFile(idFile)
            }

            onReplyMessage:
            {
                replyClicked(idMessage)
            }

        }

    }

    /*** Call this function from cpp ***/
    function addMessage()
    {
        lm_view.append({"idMessage" : container.messageId,
                        "textSubject" : container.subject,
                        "textSenderName" : container.senderName,
                        "textToName" : container.toName,
                        "textCcName" : container.ccName,
                        "textDateTime" : container.dateTime,
                        "attachFiles" : container.files,
                        "callAttachFiles" : true,
                        "textContent" : container.content})
    }

    function clearMessages()
    {
        lm_view.clear()
    }

    /*** Call this function from qml ***/
    function getContentHeight()
    {
        var result = 0
        for(var childId=1; childId<lv_view.contentItem.children.length; childId++)
        {
            result += lv_view.contentItem.children[childId].height + lv_view.spacing
        }
        result += lv_view.anchors.topMargin
        return result
    }

    function getFirstMessageId()
    {
        if( lm_view.count>0 )
        {
            return lm_view.get(0).idMessage
        }
        return 0
    }
}
